---
import PostPreview from "@/components/blog/PostPreview.astro";
import { getAllPosts, sortMDByDate } from "@/data/post";
import PageLayout from "@/layouts/Base.astro";
import Faqs from "@/components/Faqs.astro";
import Testimonials from '../components/Testimonials.astro';
import Feature from "@/components/Feature.astro";
import Bio from "@/components/Bio.astro";
import { getEntry } from 'astro:content';
import keystaticConfig from '../../keystatic.config';
import { createReader } from '@keystatic/core/reader';


import InfoBlock from "@/components/InfoBlock.astro";


import PhotoSection from "@/components/PhotoGallery.astro"
const siteSettings = await getEntry('siteSettings', 'main');
const pwaSettings = await getEntry('pwaSettings', 'index');
const { defaultView, MAX_POSTS } = siteSettings.data;
const homeContent = await getEntry('homepage', 'index');
import Mapper from '@/components/checkout.html';
const reader = createReader(process.cwd(), keystaticConfig);


const homepage = await reader.singletons.home.read();


const showBioOnHome = homepage?.showBioOnHome ?? false;
const showFaqOnHome = homepage?.showFaqOnHome ?? false;
const showTestOnHome = homepage?.showTestOnHome ?? false;
const showFeature = homepage?.showFeature ?? false;
const showPosts = homepage?.showPosts ?? false;
const ShowMore = homepage?.showMore ?? false;


const showHomeGallery = homepage?.showHomeGallery ?? false;

const allPosts = await getAllPosts();
const allPostsByDate = sortMDByDate(allPosts).slice(0, MAX_POSTS);
const language = await getEntry('language', 'index');
---
<style>
	.scroll-snap-container {
  height: 100vh;
  max-width:100vw;
  overflow-x: hidden;
  overflow-y: scroll;
  scroll-snap-type: y proximity;
  /* scroll-padding-top: 60px; */
}

.scroll-snap-container > * {
  scroll-snap-align: start;
  height: 100%;
}
</style>
<PageLayout meta={{ title: homeContent.data.title, description: pwaSettings.data.description }}>
<section class="scroll-snap-container">

	{showHomeGallery && <section><PhotoSection /></section>}
	
	<section>
	{showFeature && <Feature content={homeContent.data} />}
	{showBioOnHome && <Bio />}
	</section>


	<section id="homemap">
		<!-- <div class="w-full py-1 px-2 mb-4 text-center theme-accent backdrop-blur-lg">
			<h2 class="glow text-[clamp(1.4rem,3.9vw,4rem)] shadow-text">{homeContent.data.testimonialtitle}</h2>
		</div> -->
		<Mapper />
	</section>
	
</section>


	<section>
	<InfoBlock content={homeContent.data} />
	<br />
	{showFaqOnHome && (<Faqs />)}
	</section>
	

	{showPosts && (
			<div class="w-full py-1 px-6 mb-1 text-center theme-accent backdrop-blur-lg">
				<h2 class="glow text-[clamp(1.4rem,3.9vw,4rem)] shadow-text">{homeContent.data.postsectiontitle}</h2>
			</div>
			<div class={`contentpanel ${defaultView === 'swipe' ? 'slider panels horizontal-slider' : 'grid-container'}`} style="">
<div class="sliderSpacer" style={{ height: "", paddingTop: "", display: "" }} />
				{allPostsByDate.map((p) => <PostPreview post={p} withDesc />)}

				{ShowMore && <a class="button no-underline text-white text-center block" href="/posts/" style="padding:1vh 1rem; margin:0 50px 50px 50px;">
					{language.data.viewmore}
				</a>
				}
			</div>
	)}










{showTestOnHome && <Testimonials />}
</PageLayout>
